import{S as C,a as P,r as u,j as s,L as S,d as y}from"./index-5d20dca2.js";import{e as N,F as c,f as d,N as m,g as p,L as b}from"./Layout-00d27bdb.js";import{S as k}from"./SectionHeading-7df4f79a.js";import{l as v}from"./stripe.esm-ff582f48.js";import{u as w}from"./useMutation-46fd2380.js";import{u as I}from"./useAuthContext-7152e344.js";import{u as L}from"./useCartContext-add1cba6.js";import{u as A}from"./useFetchProducts-ebee49bf.js";const T=v(C),E=(e,n)=>w(()=>(console.log("Sending request with data:",{product_id:e,quantity:n}),N({endpoint:`create-checkout-session/${e}`,method:"POST",data:{quantity:n}})),{onSuccess:async a=>{const t=await T;if(!t){console.log("Stripe failed to initialize.");return}const{error:i}=await t.redirectToCheckout({sessionId:a.id});i&&console.log(i)},onError:a=>{console.log(a)}}),U=({product:e,loading:n,handleAddToCart:a,isLoggedIn:t,isSuperUser:i})=>{const o=P(),[l,h]=u.useState(1),{mutateAsync:g,isLoading:x}=E(e==null?void 0:e.id,l),j=()=>{o("/product-form",{state:{action:"update",product:e}})},f=async()=>{try{await g()}catch(r){console.error(r)}};return n?s.jsx("section",{id:"product-detail",children:s.jsx(S,{})}):s.jsxs("section",{id:"product-detail",children:[t&&i?s.jsx(k,{onClick:j,headingText:`${e?e.name:""}`,buttonLabel:"Update Product",buttonUrl:"/product-form",buttonIcon:s.jsx(c,{icon:d,className:"icon"})}):s.jsx("h2",{className:"section-heading",children:`${e?e.name:""}`}),s.jsxs("div",{className:"product-detail",children:[s.jsx("img",{src:e==null?void 0:e.image,alt:e==null?void 0:e.name}),s.jsxs("div",{className:"product-info",children:[s.jsxs("h2",{children:["Price: €",e==null?void 0:e.price]}),s.jsx("p",{children:e==null?void 0:e.description}),s.jsxs("ul",{className:"input-nav",children:[s.jsx("label",{htmlFor:"quantity",children:"Quantity:"}),s.jsx("input",{type:"number",value:l,onChange:r=>h(parseInt(r.target.value,10)),disabled:x})]}),s.jsxs("ul",{className:"product-nav",children:[s.jsx(m,{to:"/cart",icon:s.jsx(c,{icon:p}),onClick:a,label:`Add to Cart - €${(e==null?void 0:e.price)??"N/A"}`}),s.jsx(m,{onClick:f,icon:s.jsx(c,{icon:d}),label:"Buy Now"})]})]})]})]})};function $(){const{productId:e}=y(),{products:n,error:a,loading:t}=A({endpoint:`products/${e}`,method:"GET",isSingleProduct:!0});return{product:n?n[0]:null,error:a,loading:t}}const H=()=>{const{product:e,loading:n}=$(),{addToCart:a}=L(),{isLoggedIn:t,isSuperUser:i}=I(),o=u.useCallback(()=>{e&&a({id:e.id,name:e.name,price:e.price,image:e.image,description:e.description,quantity:1})},[a,e]);return s.jsx(b,{children:s.jsx(U,{product:e,loading:n,handleAddToCart:o,isLoggedIn:t,isSuperUser:i})})};export{H as default};
